@{
    ViewBag.Title = "Home Page";
}

<img id="dropImage" src="~/MyImages/DropImage.png" style="vertical-align:middle"/>

<script>
    var dropbox = document.getElementById('dropImage');

    // Setup drag and drop handlers.
    dropbox.addEventListener('dragenter', stopDefault, false);
    dropbox.addEventListener('dragover', stopDefault, false);
    dropbox.addEventListener('dragleave', stopDefault, false);
    dropbox.addEventListener('drop', onDrop, false);

    function stopDefault(e) {
        e.stopPropagation();
        e.preventDefault();
    }

    function onDrop(e) {
        e.stopPropagation();
        e.preventDefault();


        var readFileSize = 0;
        var files = e.dataTransfer.files;


        file = files[0];
        readFileSize += file.fileSize;

        // Only process image files. 
        var imageType = /image.*/;

        if (!file.type.match(imageType)) {
            return;
        }

        var reader = new FileReader();

        reader.onerror = function (e) {
            alert('Error code: ' + e.target.error);
        };

        // Create a closure to capture the file information. 
        reader.onload = (function (aFile) {
            return function (evt) {
                  dropbox.src = evt.target.result;
                  dropbox.style.width = "539px";
            }
        })(file);
        loadXMLDoc(file);
        // Read in the image file as a data url. 
        reader.readAsDataURL(file);
    }
    function loadXMLDoc(file) {
        var xmlhttp;

        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        }
        else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function () { // Processing the response
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {

                var response = xmlhttp.responseText;
                var arrayOfStrings = response.split(" ");
                
                var mainContent = document.getElementById("mainContent");

                var newImg = document.createElement("img");
                newImg.src = arrayOfStrings[0];
                newImg.style.width = "539px";

                mainContent.appendChild(newImg);
            }
        }
        // An HTTP POST Request to the server with the dropped image named as "file"
        var fd = new FormData(); 
        fd.append("fileUpload", file);
        xmlhttp.open("POST", "Image/GetThumbnails", true);
        xmlhttp.send(fd);
    }

</script>
